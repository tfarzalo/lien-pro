// =====================================================// Deadlines List Component// Displays deadlines with filtering, sorting, and highlighting// =====================================================import { useState, useMemo } from 'react';import { Card, CardContent } from '@/components/ui/Card';import { Button } from '@/components/ui/Button';import { Badge } from '@/components/ui/Badge';import { Alert, AlertDescription, AlertTitle } from '@/components/ui/Alert';import { Deadline } from '@/lib/deadlineCalculator';import {  AlertCircle,  AlertTriangle,  Clock,  CheckCircle,  Calendar,  ChevronDown,  ChevronUp,  Info,  FileText,} from 'lucide-react';import { format, formatDistanceToNow, isPast, isFuture, isToday, addDays } from 'date-fns';// =====================================================// Types// =====================================================interface DeadlinesListProps {  deadlines: Deadline[];  showFilters?: boolean;  maxItems?: number;  onDeadlineClick?: (deadline: Deadline) => void;  compact?: boolean;}type FilterType = 'all' | 'overdue' | 'urgent' | 'upcoming' | 'completed';type SortType = 'date' | 'severity' | 'status';// =====================================================// Main Component// =====================================================export function DeadlinesList({  deadlines,  showFilters = true,  maxItems,  onDeadlineClick,  compact = false,}: DeadlinesListProps) {  const [filter, setFilter] = useState<FilterType>('all');  const [sortBy, setSortBy] = useState<SortType>('date');  const [expandedDeadlines, setExpandedDeadlines] = useState<Set<string>>(new Set());  // Filter and sort deadlines  const filteredDeadlines = useMemo(() => {    let filtered = deadlines;    // Apply filter    switch (filter) {      case 'overdue':        filtered = filtered.filter(          (d) => d.status !== 'completed' && isPast(new Date(d.dueDate))        );        break;      case 'urgent':        filtered = filtered.filter(          (d) =>            d.status !== 'completed' &&            d.severity === 'critical' &&            isFuture(new Date(d.dueDate))        );        break;      case 'upcoming':        filtered = filtered.filter(          (d) =>            d.status !== 'completed' &&            isFuture(new Date(d.dueDate)) &&            new Date(d.dueDate) <= addDays(new Date(), 30)        );        break;      case 'completed':        filtered = deadlines.filter((d) => d.status === 'completed');        break;      default:        filtered = filtered.filter((d) => d.status !== 'completed');    }    // Sort    switch (sortBy) {      case 'date':        filtered.sort((a, b) => new Date(a.dueDate).getTime() - new Date(b.dueDate).getTime());        break;      case 'severity':        const severityOrder = { critical: 0, high: 1, medium: 2, low: 3 };        filtered.sort((a, b) => severityOrder[a.severity] - severityOrder[b.severity]);        break;      case 'status':        const statusOrder: Record<string, number> = { overdue: 0, pending: 1, due_soon: 1.5, upcoming: 2, completed: 3 };        filtered.sort((a, b) => (statusOrder[a.status] || 99) - (statusOrder[b.status] || 99));        break;    }    return maxItems ? filtered.slice(0, maxItems) : filtered;  }, [deadlines, filter, sortBy, maxItems]);  // Get counts for filter badges  const counts = useMemo(() => {    const activeDeadlines = deadlines.filter((d) => d.status !== 'completed');    return {      all: activeDeadlines.length,      overdue: activeDeadlines.filter((d) => isPast(new Date(d.dueDate))).length,      urgent: activeDeadlines.filter((d) => d.severity === 'critical' && isFuture(new Date(d.dueDate))).length,      upcoming: activeDeadlines.filter(        (d) => isFuture(new Date(d.dueDate)) && new Date(d.dueDate) <= addDays(new Date(), 30)      ).length,      completed: deadlines.filter((d) => d.status === 'completed').length,    };  }, [deadlines]);  const toggleExpanded = (deadlineId: string) => {    const newExpanded = new Set(expandedDeadlines);    if (newExpanded.has(deadlineId)) {      newExpanded.delete(deadlineId);    } else {      newExpanded.add(deadlineId);    }    setExpandedDeadlines(newExpanded);  };  // Show urgent alert if there are overdue or critical deadlines  const showUrgentAlert = counts.overdue > 0 || counts.urgent > 0;  return (    <div className="space-y-4">      {/* Urgent Alert */}      {showUrgentAlert && (        <Alert variant={counts.overdue > 0 ? 'danger' : 'warning'}>          <AlertCircle className="h-4 w-4" />          <AlertTitle>Action Required</AlertTitle>          <AlertDescription>            {counts.overdue > 0 && (              <span>                You have <strong>{counts.overdue}</strong> overdue deadline{counts.overdue > 1 ? 's' : ''}.              </span>            )}            {counts.overdue > 0 && counts.urgent > 0 && ' '}            {counts.urgent > 0 && (              <span>                <strong>{counts.urgent}</strong> critical deadline{counts.urgent > 1 ? 's' : ''} approaching.              </span>            )}          </AlertDescription>        </Alert>      )}      {/* Filters */}      {showFilters && (        <Card>          <CardContent className="p-4">            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">              {/* Filter Buttons */}              <div className="flex flex-wrap gap-2">                <FilterButton                  label="All"                  count={counts.all}                  active={filter === 'all'}                  onClick={() => setFilter('all')}                />                <FilterButton                  label="Overdue"                  count={counts.overdue}                  active={filter === 'overdue'}                  onClick={() => setFilter('overdue')}                  variant="danger"                />                <FilterButton                  label="Urgent"                  count={counts.urgent}                  active={filter === 'urgent'}                  onClick={() => setFilter('urgent')}                  variant="warning"                />                <FilterButton                  label="Upcoming"                  count={counts.upcoming}                  active={filter === 'upcoming'}                  onClick={() => setFilter('upcoming')}                />                <FilterButton                  label="Completed"                  count={counts.completed}                  active={filter === 'completed'}                  onClick={() => setFilter('completed')}                  variant="success"                />              </div>              {/* Sort Dropdown */}              <div className="flex items-center gap-2">                <span className="text-sm text-slate-600">Sort by:</span>                <select                  value={sortBy}                  onChange={(e) => setSortBy(e.target.value as SortType)}                  className="text-sm border border-slate-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-brand-500"                >                  <option value="date">Date</option>                  <option value="severity">Severity</option>                  <option value="status">Status</option>                </select>              </div>            </div>          </CardContent>        </Card>      )}      {/* Deadlines List */}      {filteredDeadlines.length === 0 ? (        <Card>          <CardContent className="p-12 text-center">            <CheckCircle className="h-12 w-12 text-slate-300 mx-auto mb-3" />            <p className="text-slate-500">No deadlines to display</p>          </CardContent>        </Card>      ) : (        <div className="space-y-3">          {filteredDeadlines.map((deadline) => (            <DeadlineCard              key={deadline.id || deadline.title}              deadline={deadline}              compact={compact}              expanded={expandedDeadlines.has(deadline.id || '')}              onToggleExpanded={() => toggleExpanded(deadline.id || '')}              onClick={onDeadlineClick}            />          ))}        </div>      )}    </div>  );}// =====================================================// Sub-Components// =====================================================interface FilterButtonProps {  label: string;  count: number;  active: boolean;  onClick: () => void;  variant?: 'default' | 'danger' | 'warning' | 'success';}function FilterButton({ label, count, active, onClick, variant = 'default' }: FilterButtonProps) {  const variantClasses = {    default: active ? 'bg-brand-100 text-brand-700 border-brand-300' : 'bg-white text-slate-700 border-slate-300',    danger: active ? 'bg-danger-100 text-danger-700 border-danger-300' : 'bg-white text-slate-700 border-slate-300',    warning: active ? 'bg-warning-100 text-warning-700 border-warning-300' : 'bg-white text-slate-700 border-slate-300',    success: active ? 'bg-success-100 text-success-700 border-success-300' : 'bg-white text-slate-700 border-slate-300',  };  return (    <button      onClick={onClick}      className={`px-3 py-1.5 text-sm font-medium border rounded-lg transition-colors hover:bg-slate-50 ${variantClasses[variant]}`}    >      {label} <span className="font-semibold">({count})</span>    </button>  );}interface DeadlineCardProps {  deadline: Deadline;  compact: boolean;  expanded: boolean;  onToggleExpanded: () => void;  onClick?: (deadline: Deadline) => void;}function DeadlineCard({ deadline, compact, expanded, onToggleExpanded, onClick }: DeadlineCardProps) {  const dueDate = new Date(deadline.dueDate);  const isOverdue = isPast(dueDate) && deadline.status !== 'completed';  const isUrgent = deadline.severity === 'critical' && isFuture(dueDate);  const isDueToday = isToday(dueDate);  // Determine card styling based on status and severity  const cardConfig = useMemo(() => {    if (deadline.status === 'completed') {      return {        bgColor: 'bg-slate-50',        borderColor: 'border-slate-200',        icon: CheckCircle,        iconColor: 'text-success-600',        badge: { label: 'Completed', variant: 'success' as const },      };    }    if (isOverdue) {      return {        bgColor: 'bg-danger-50',        borderColor: 'border-danger-300',        icon: AlertCircle,        iconColor: 'text-danger-600',        badge: { label: 'OVERDUE', variant: 'danger' as const },      };    }    if (isDueToday) {      return {        bgColor: 'bg-warning-50',        borderColor: 'border-warning-300',        icon: AlertTriangle,        iconColor: 'text-warning-600',        badge: { label: 'DUE TODAY', variant: 'warning' as const },      };    }    if (isUrgent) {      return {        bgColor: 'bg-warning-50',        borderColor: 'border-warning-300',        icon: AlertTriangle,        iconColor: 'text-warning-600',        badge: { label: 'URGENT', variant: 'warning' as const },      };    }    if (deadline.severity === 'high') {      return {        bgColor: 'bg-blue-50',        borderColor: 'border-blue-200',        icon: Clock,        iconColor: 'text-blue-600',        badge: { label: 'High Priority', variant: 'primary' as const },      };    }    return {      bgColor: 'bg-white',      borderColor: 'border-slate-200',      icon: Calendar,      iconColor: 'text-slate-600',      badge: { label: 'Normal', variant: 'secondary' as const },    };  }, [deadline, isOverdue, isUrgent, isDueToday]);  const Icon = cardConfig.icon;  return (    <Card className={`${cardConfig.bgColor} ${cardConfig.borderColor} border-2 transition-all hover:shadow-md`}>      <CardContent className="p-4">        {/* Header Row */}        <div className="flex items-start justify-between mb-2">          <div className="flex items-start space-x-3 flex-1">            <Icon className={`h-5 w-5 ${cardConfig.iconColor} flex-shrink-0 mt-0.5`} />            <div className="flex-1 min-w-0">              <div className="flex items-center gap-2 flex-wrap">                <h4                  className={`font-semibold text-slate-900 text-sm ${onClick ? 'cursor-pointer hover:text-brand-600' : ''}`}                  onClick={onClick ? () => onClick(deadline) : undefined}                >                  {deadline.title}                </h4>                {deadline.isOptional && (                  <Badge variant="secondary" className="text-xs">                    Optional                  </Badge>                )}              </div>              {!compact && (                <p className="text-xs text-slate-600 mt-1 line-clamp-2">{deadline.description}</p>              )}            </div>          </div>          <Badge variant={cardConfig.badge.variant}>{cardConfig.badge.label}</Badge>        </div>        {/* Date and Time Info */}        <div className="flex items-center justify-between mt-3 pt-3 border-t border-slate-200">          <div className="flex items-center gap-4 text-xs text-slate-600">            <div className="flex items-center gap-1">              <Calendar className="h-3.5 w-3.5" />              {format(dueDate, 'MMM d, yyyy')}            </div>            <div className={`font-semibold ${isOverdue ? 'text-danger-700' : 'text-slate-900'}`}>              {isOverdue ? 'Overdue by ' : ''}              {formatDistanceToNow(dueDate, { addSuffix: !isOverdue })}            </div>          </div>          {!compact && (            <button              onClick={onToggleExpanded}              className="text-slate-600 hover:text-slate-900 p-1 rounded hover:bg-slate-200 transition-colors"              aria-label={expanded ? 'Show less' : 'Show more'}            >              {expanded ? <ChevronUp className="h-4 w-4" /> : <ChevronDown className="h-4 w-4" />}            </button>          )}        </div>        {/* Expanded Details */}        {expanded && !compact && (          <div className="mt-4 pt-4 border-t border-slate-200 space-y-3">            {/* Legal Reference */}            {deadline.legalReference && (              <div className="flex items-start gap-2">                <Info className="h-4 w-4 text-blue-600 flex-shrink-0 mt-0.5" />                <div>                  <p className="text-xs font-semibold text-slate-700">Legal Reference</p>                  <p className="text-xs text-slate-600">{deadline.legalReference}</p>                </div>              </div>            )}            {/* Action Items */}            {deadline.actionItems && deadline.actionItems.length > 0 && (              <div>                <p className="text-xs font-semibold text-slate-700 mb-2 flex items-center gap-1">                  <FileText className="h-3.5 w-3.5" />                  Action Items                </p>                <ul className="space-y-1.5 ml-5">                  {deadline.actionItems.map((item, index) => (                    <li key={index} className="text-xs text-slate-600 list-disc">                      {item}                    </li>                  ))}                </ul>              </div>            )}            {/* Actions */}            <div className="flex gap-2 pt-2">              {deadline.status !== 'completed' && (                <>                  <Button size="sm" variant="primary">                    Mark Complete                  </Button>                  <Button size="sm" variant="secondary">                    Set Reminder                  </Button>                </>              )}              <Button size="sm" variant="ghost">                View Details              </Button>            </div>          </div>        )}      </CardContent>    </Card>  );}